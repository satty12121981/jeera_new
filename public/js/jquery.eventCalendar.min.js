/**
 * @preserve: jquery.eventCalendar.js
 * @author:   Jaime Fernandez (@vissit)
 * @company:  Paradigma Tecnologico (@paradigmate)
 * @version:  1.05
 * @date:     2013-08-06
 * @website:  http://www.vissit.com/projects/eventCalendar/
 */
!function(e){"use strict";function t(t,n,a){var s=this,r=!1;s.type="none",s.interval=0,s.end="none",s._index=0;var i=function(){s.type="none",s.interval=0,s.end="none",s._index=0},l=function(e){e&&a&&a(e),i(),r=!0},o=function(){if(i(),!t||!t.type)return l("No recurrence data provided"),void 0;var a=t.type.toLowerCase();return"none"!==a?e.inArray(a,["day","week","month","year"])<0?(l("Invalid recurrence type: "+a),void 0):(s.type=a,s.interval=t.interval?parseInt(t.interval,10):0,!s.interval||s.interval<1?(l("Invalid recurrence interval: "+t.interval),void 0):(void 0===t.end?s.end="none":"object"==typeof t.end&&t.end.getMonth?s.end=t.end.clone():"number"==typeof t.end?s.end=parseInt(t.end,10):"string"==typeof t.end&&(s.end=t.end.toLowerCase(),""===s.end?s.end="none":"none"!==s.end&&(n&&(s.end="timestamp"===n.toLowerCase()?new Date(parseInt(t.end,10)):Date.parseExact(t.end,n)),s.end||(s.end=Date.parse(t.end)))),s.end?void 0:(l("Invalid end recurrence: "+t.end),void 0))):void 0};s.getRecurrenceDate=function(e,t){if(t||(t=0),!e||0>t)return null;var n=new Date(e);s._index=0;for(var a=0;t>a&&(n=s.getNextRecurrenceDate(n));)a+=1;return s._index=a,n},s.getNextRecurrenceDate=function(e){if(!e)return null;var t=new Date(e);switch(s.type){case"day":t=t.addDays(s.interval),s._index+=1;break;case"week":t=t.addWeeks(s.interval),s._index+=1;break;case"month":t=t.addMonths(s.interval),s._index+=1;break;case"year":t=t.addYears(s.interval),s._index+=1;break;default:t=null}return null!==t&&"none"!==s.end&&("object"==typeof s.end&&s.end.getMonth?t.isAfter(s.end)&&(t=null):"number"==typeof s.end&&s._index>=s.end&&(t=null)),t},o()}function n(){var e=this;e.id=null,e.startDate=null,e.endDate=null,e.listingStartOffset=0,e.listingNumberOfDays=1,e.title=null,e.description=null,e.url=null,e.classEvent=null,e.classTitle=null,e.classDescription=null}function a(e,s,r){var i=this,l=0,o=!1;i.recurrence=null,i.id=null,i.startDate=null,i.endDate=null,i.listingStartOffset=0,i.listingNumberOfDays=1,i.title=null,i.description=null,i.url=null,i.classEvent=null,i.classTitle=null,i.classDescription=null;var d=864e5,c=function(e,t){var n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),a=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((a-n)/d)},u=function(e,t){var s;if(0>l&&(l=0),l>0&&(!i.recurrence||"none"===i.recurrence.type))return null;var r=void 0!==e?e:-1,o=void 0!==t?t:-1,d=i.recurrence.getRecurrenceDate(i.startDate,l);if(d){var u=c(i.startDate,d);if(s=new Date(i.endDate).addDays(u),d&&(r>=0||o>=0))for(;!a.datePeriodIsCurrent(d,s,r,o)&&(d=i.recurrence.getNextRecurrenceDate(d));)u=c(i.startDate,d),s=new Date(i.endDate).addDays(u)}var v=null;return d&&(v=new n,v.id=i.id,v.startDate=d,v.endDate=s,v.listingStartOffset=i.listingStartOffset,v.listingNumberOfDays=i.listingNumberOfDays,v.title=i.title,v.description=i.description,v.url=i.url,v.classEvent=i.classEvent,v.classTitle=i.classTitle,v.classDescription=i.classDescription),v},v=function(){i.recurrence=null,i.id=null,i.startDate=null,i.endDate=null,i.listingStartOffset=0,i.listingNumberOfDays=1,i.title=null,i.description=null,i.url=null,i.classEvent=null,i.classTitle=null,i.classDescription=null},f=function(e){e&&r&&r(e),v(),o=!0},g=function(e,t){if(!e)return null;var n=null;return"object"==typeof e&&e.getMonth?n=e.clone():"number"==typeof e?n=new Date(e):"string"==typeof e&&t&&(n="timestamp"===t.toLowerCase()?new Date(parseInt(e,10)):Date.parseExact(e,t)),n||(n=Date.parse(e)),n},p=function(){return v(),e?(i.recurrence=new t(e.recurrence,s),i.id=e.id,i.startDate=e.startDate?g(e.startDate,s):null,i.startDate||(i.startDate=e.date?g(e.date,s):null),i.endDate=e.endDate?g(e.endDate,s):g(i.startDate),i.listingStartOffset=e.listingStartOffset||0,i.listingNumberOfDays=e.listingNumberOfDays||1,i.title=e.title,i.description=e.description,i.url=e.url,i.classEvent=e.classEvent,i.classTitle=e.classTitle,i.classDescription=e.classDescription||e.type,void 0):(f("No event data provided"),void 0)};i.getFirstEventInstance=function(e,t){return l=0,u(e,t)},i.getNextEventInstance=function(e,t){return l+=1,u(e,t)},p()}function s(t,n){var s=this,r=e(t),i="300",l={},o=function(e){r.find(".eventsCalendar-list-wrap").html("<span class='eventsCalendar-loading error'>"+e+" "+s.settings.eventsJson+"</span>")},d=function(){i=r.width(),r.find(".eventsCalendar-monthWrap").width(r.width()+"px"),r.find(".eventsCalendar-list-wrap").width(r.width()+"px")},c=function(){d(),e(window).resize(function(){d()})},u=function(t,n,l,o,c,u){var v="-="+i,f="auto",g=""!==l?parseInt(l,10):-1,p=""!==o?parseInt(o,10):-1,D=""!==c?parseInt(c,10):-1,h=r.find(".eventsCalendar-list-wrap .eventsCalendar-subtitle");if(u){var y=new Date(g,p,D>=0?D:1,0,0,0),m=D>-1?y.toString(s.settings.textEventHeaderDayView):y.toString(s.settings.textEventHeaderMonthView);h.html(m),"prev"===u?v="+="+i:("day"===u||"month"===u)&&(v="+=0",f=0)}else h.html(s.settings.textNextEvents),f="auto",v="-=0";r.find(".eventsCalendar-list").finish().animate({opacity:s.settings.moveOpacity,left:v,height:f},s.settings.moveSpeed,function(){r.find(".eventsCalendar-list").css({left:0,height:"auto"}).hide(),r.find(".dayWithEvents").removeClass("dayWithEvents");var i=[];t=e(t).sort(function(e,t){var n;return n=s.settings.sortAscending?e.startDate.toLowerCase()>t.startDate.toLowerCase()?1:-1:e.startDate.toLowerCase()<t.startDate.toLowerCase()?1:-1});var l=s.settings.onBeforeInitialiseList;if(l&&"function"==typeof l&&l(),t.length){var o=0;e.each(t,function(e,t){var l=new a(t,s.settings.jsonDateFormat);s.addEventToCalendar(l,function(e,t){var n=r.find(".currentMonth .eventsCalendar-daysList #dayList_"+t);n.hasClass("dayWithEvents")||n.addClass("dayWithEvents")},function(a,r){if(0!==n&&o>=n)return!1;var l=a.classEvent?' class="'+a.classEvent+'"':"",d=' class="eventTitle';d+=a.classTitle?" "+a.classTitle:"",d+=r?" "+r:"",d+='"';var c=' class="eventDescription';c+=a.classDescription?" "+a.classDescription:"",c+=s.settings.showDescription?"":" hidden",c+='"';var u,v=s.settings.openEventInNewWindow?"_blank":"_self";u=a.url?'<a href="'+a.url+'" target="'+v+'"'+d+">"+a.title+"</a>":"<span"+d+">"+a.title+"</span>",i.push('<li id="'+e+'"'+l+">"+u+"<div"+c+">"+t.description+"</div></li>");var f=s.settings.onEventAddedToList;return f&&"function"==typeof f&&f(a),o+=1,!0},g,p,D)})}i.length||i.push('<li class="eventsCalendar-noEvents"><p>'+s.settings.textNoEvents+"</p></li>");var d=s.settings.onAfterInitialiseList;d&&"function"==typeof d&&d(),r.find(".eventsCalendar-loading").finish().hide(),r.find(".eventsCalendar-list").html(i.join("")),s.settings.collapsible&&r.find(".eventDescription").hide(),r.find(".eventsCalendar-list").animate({opacity:1,height:"toggle"},s.settings.moveSpeed)}),d()},v=function(t,n,a,i,d){var c=t||0,v="number"==typeof n?n:s.settings.currentDate.getFullYear(),f="number"==typeof a?a:s.settings.currentDate.getMonth(),g="number"==typeof i?i:-1;r.find(".eventsCalendar-loading").fadeIn(),s.settings.jsonData?(s.settings.cacheJson=!0,l=s.settings.jsonData,u(l,c,v,f,g,d)):s.settings.cacheJson&&d?u(l,c,v,f,g,d):e.getJSON(s.settings.eventsjson+"?limit="+c+"&year="+v+"&month="+f+"&day="+g,function(e){l=e,u(l,c,v,f,g,d)}).error(function(){o("error getting json: ")}),r.find(".current").removeClass("current"),g>""&&r.find("#dayList_"+g).addClass("current")},f=function(t){var n,a=null;"current"===t?a=s.settings.currentDate:(a=new Date(r.attr("data-current-year"),r.attr("data-current-month"),1,0,0,0),a="prev"===t?a.addMonths(-1):a.addMonths(1));var i=a.getFullYear(),l=a.getMonth();r.attr("data-current-month",l).attr("data-current-year",i);var o=e("<div class='eventsCalendar-slider'></div>"),d=e("<div class='eventsCalendar-monthWrap'></div>"),c=e("<div class='eventsCalendar-currentTitle'><a href='#' class='monthTitle'></a></div>"),u=e("<a href='#' class='arrow prev'><span>"+s.settings.textPrevious+"</span></a><a href='#' class='arrow next'><span>"+s.settings.textNext+"</span></a>"),f=e("<ul class='eventsCalendar-daysList'></ul>");r.find(".eventsCalendar-slider").size()?(o=r.find(".eventsCalendar-slider"),o.append(d)):(r.prepend(o),o.append(d),o.append(u)),r.find(".eventsCalendar-monthWrap.currentMonth").removeClass("currentMonth").addClass("oldMonth"),d.addClass("currentMonth").append(c,f),"current"!==t&&v(s.settings.eventsLimit,i,l,!1,t),c.find(".monthTitle").html(a.toString(s.settings.textCalendarTitle));var g=[];if(s.settings.showDayAsWeeks){if(f.addClass("showAsWeek"),s.settings.showDayNameInCalendar){f.addClass("showDayNames");var p=Date.today().moveToDayOfWeek(s.settings.startWeekOnMonday?1:0);for(n=0;7>n;n+=1)g.push('<li class="eventsCalendar-day-header">'+p.toString(s.settings.dayNameFormat)+"</li>"),p.addDays(1)}var D=a.clone().moveToFirstDayOfMonth().getDay();for(s.settings.startWeekOnMonday&&(D-=1,0>D&&(D=6)),n=0;D>n;n+=1)g.push('<li class="eventsCalendar-day empty"></li>')}var h=Date.getDaysInMonth(a.getFullYear(),a.getMonth());for(n=1;h>=n;n+=1)g.push('<li id="dayList_'+n+'" rel="'+n+'" class="eventsCalendar-day"><a href="#">'+n+"</a></li>");f.append(g.join("")),o.height(d.height()+"px")};s.addEventToCalendar=function(e,t,n,r,i,l){function o(){return n&&"function"==typeof n?m&&s.settings.groupEvents?!1:y||a.datePeriodIsCurrent(u,v,g,p,D)?!s.settings.allowPartialEvents||1>D||h.between(s.settings.startDate,s.settings.endDate):!1:!1}function d(){return t&&"function"==typeof t?-1!==g&&f.getFullYear()!==g?!1:-1!==p&&f.getMonth()!==p?!1:!s.settings.allowPartialEvents||f.between(s.settings.startDate,s.settings.endDate):!1}function c(e,t){var n=s.settings.startDate,a=s.settings.endDate;return e.between(n,a)||t.between(n,a)}if(e&&t){var u,v,f,g="number"==typeof r?r:s.settings.currentDate.getFullYear(),p="number"==typeof i?i:s.settings.currentDate.getMonth(),D="number"==typeof l?l:-1,h=0>g||0>p||0>D?s.settings.startDate:new Date(g,p,D,0,0,0),y=!1,m=!1,C=e.getFirstEventInstance();if(C.listingNumberOfDays<1)return!1;for(;C;){var w=c(C.startDate,C.endDate);if(w){var E=s.settings.onBeforeAddingEvent;E&&"function"==typeof E&&E(C)}if(a.datePeriodIsInTheFuture(C,g,p))break;if(w&&(u=C.startDate.clone(),u=u.addDays(C.listingStartOffset),v=u.clone(),v=v.addDays(C.listingNumberOfDays-1),y=a.datePeriodIsCurrent(C.startDate,C.endDate,g,p,D),o()&&(m=m||n(C,y?" current":"")),t&&"function"==typeof t)){if(s.settings.highlightEventDays)for(f=new Date(C.startDate);f.compareTo(C.endDate)<=0;)d()&&t(C,f.getDate()),f.addDays(1);if(s.settings.highlightListingDays)for(f=u.clone();f.compareTo(v)<=0;)d()&&t(C,f.getDate()),f.addDays(1)}C=e.getNextEventInstance()}}},s.settings={};var g=function(){r.addClass("eventCalendar-wrap").append("<div class='eventsCalendar-list-wrap'><p class='eventsCalendar-subtitle'></p><span class='eventsCalendar-loading'>loading...</span><div class='eventsCalendar-list-content'><ul class='eventsCalendar-list'></ul></div></div>")},p=function(){s.settings.eventsScrollable&&r.find(".eventsCalendar-list-content").addClass("scrollable")},D=function(){r.find(".arrow").click(function(t){t.preventDefault();var n;e(this).hasClass("next")?(f("next"),n="-="+i):(f("prev"),n="+="+i),r.find(".eventsCalendar-monthWrap.oldMonth").animate({opacity:s.settings.moveOpacity,left:n},s.settings.moveSpeed,function(){r.find(".eventsCalendar-monthWrap.oldMonth").remove()})})},h=function(){s.settings=e.extend({},e.fn.eventCalendar.defaults,n),g(),p(),c(),f("current");var t=parseInt(r.attr("data-current-year"),10),a=parseInt(r.attr("data-current-month"),10),i=s.settings.currentDate.getDate();s.settings.initialEventList&&"day"===s.settings.initialEventList?v(s.settings.eventsLimit,t,a,i,"day"):s.settings.initialEventList&&"month"===s.settings.initialEventList?v(s.settings.eventsLimit,t,a,!1,"month"):v(s.settings.eventsLimit,!1,!1,!1,!1),D(),r.on("click",".eventsCalendar-day a",function(t){t.preventDefault();var n=parseInt(r.attr("data-current-year"),10),a=parseInt(r.attr("data-current-month"),10),s=parseInt(e(this).parent().attr("rel"),10);v(!1,n,a,s,"day")}),r.on("click",".monthTitle",function(e){e.preventDefault();var t=parseInt(r.attr("data-current-year"),10),n=parseInt(r.attr("data-current-month"),10);v(s.settings.eventsLimit,t,n,!1,"month")}),r.find(".eventsCalendar-list").on("click",".eventTitle",function(t){if(s.settings.collapsible&&s.settings.showDescription){t.preventDefault();var n=e(this).parent().find(".eventDescription");if(!n.find("a").size()){var a=e(this).attr("href"),i=e(this).attr("target");a&&a.length>0&&n.append('<a href="'+a+'" target="'+i+'" class="bt">'+s.settings.textGoToEventUrl+"</a>")}n.is(":visible")?n.slideUp():(s.settings.onlyOneDescription&&r.find(".eventDescription").slideUp(),n.slideDown())}})};h()}a.datePeriodIsCurrent=function(e,t,n,a,s){var r=0,i=0,l=0;return n>=0&&(r+=1e4*e.getFullYear(),i+=1e4*t.getFullYear(),l+=1e4*n),a>=0&&(r+=100*e.getMonth(),i+=100*t.getMonth(),l+=100*a),s>=0&&(r+=e.getDate(),i+=t.getDate(),l+=s),l>=r&&i>=l},a.datePeriodIsInTheFuture=function(e,t,n,a){var s=e.startDate.clone();s=s.addDays(e.listingStartOffset);var r=e.startDate.isBefore(s)?e.startDate:s,i=0,l=0;return t>=0&&(i+=1e4*r.getFullYear(),l+=1e4*t),n>=0&&(i+=100*r.getMonth(),l+=100*n),a>=0&&(i+=r.getDate(),l+=a),i>l},e.fn.eventCalendar=function(t){return this.each(function(){var n=e(this);if(!n.data("eventCalendar")){var a=new s(this,t);n.data("eventCalendar",a)}})},e.fn.eventCalendar.defaults={eventsJson:"js/events.json",jsonData:"",jsonDateFormat:"timestamp",cacheJson:!0,sortAscending:!0,onBeforeInitialiseList:!1,onAfterInitialiseList:!1,onEventAddedToList:!1,onBeforeAddingEvent:!1,eventsLimit:4,dayNameFormat:"ddd",textCalendarTitle:"MMMM yyyy",textEventHeaderDayView:"MMMM dS even\\t\\s:",textEventHeaderMonthView:"MMMM even\\t\\s:",textNoEvents:"There are no events in this period",textNext:"next",textPrevious:"prev",textNextEvents:"Next events:",textGoToEventUrl:"See the event",highlightEventDays:!0,highlightListingDays:!1,showDayAsWeeks:!0,startWeekOnMonday:!0,showDayNameInCalendar:!0,showDescription:!1,collapsible:!1,onlyOneDescription:!0,groupEvents:!1,openEventInNewWindow:!1,eventsScrollable:!1,initialEventList:!1,currentDate:Date.today(),startDate:new Date(1900,0,1,0,0,0),endDate:new Date(2999,0,1,0,0,0),allowPartialEvents:!1,moveSpeed:500,moveOpacity:.15},e.EventRecurrence=t,e.EventInstance=n,e.EventItem=a,e.EventCalendar=s}(jQuery);